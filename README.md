# 정현 시도

#### result

```
lightning amp 관련 에러나는데 해결 방법을 모르겠음
lightning 다 빼고 학습하면 forward 쪽에서 오류남 (loss 관련..?)
```

#### Requirement
```
pytorch==1.4.0
transformers==3.5.0
pytorch-lightning==1.0.3 / (수정 후 error1 해결)
kobert_transformers==0.4.1
apex 다운로드 (python version) /오류 뜨면 링크 통해서 받으면 됨
```

<br>

#### Error

- error1 : 해결

~~raise RuntimeError("Invoked 'with amp.scale_loss', but internal Amp state has not been initialized. RuntimeError: Invoked 'with amp.scale_loss', but internal Amp state has not been initialized.  model, optimizer = amp.initialize(model, optimizer, opt_level=...) must be called before 'with amp.scale_loss'.~~


- error2 : 미해결 / except로 우선 빼둠

json.decoder.JSONDecodeError: Expecting ',' delimiter: line 1 column 2947 (char 2946) 
json file 읽을때 생기는 에러 , 데이터 살펴보면서 확인해 봐야할 거 같음



- index 73
> Original text:  원심판결 및 원심이 인용한 제1심판결 이유에 의하면 원심은 근로기준법은 현실적으로 근로를 제공하는 자에 대하여 국가의 관리 감독에 의한 직접적인 보호의 필요성이 있는가라는 관점에서 개별적 노사관계를 규율할 목적으로 제정된 것인 반면에 노동조합및노동관계조정법이하 노조법이라 한다은 노무공급자들 사이의 단결권 등을 보장해 줄 필요성이 있는가라는 관점에서 집단적 노사관계를 규율할 목적으로 제정된 것으로 그 입법목적에 따라 근로자의 개념을 상이하게 정의하고 있는 점 일정한 사용자에의 종속관계를 조합원의 자격요건으로 하는 기업별 노동조합의 경우와는 달리 산업별 직종별 지역별 노동조합 등의 경우에는 원래부터 일정한 사용자에의 종속관계를 조합원의 자격요건으로 하는 것이 아닌 점에 비추어 노조법 제2조 제4호 라목 단서는 기업별 노동조합의 조합원이 사용자로부터 해고됨으로써 근로자성이 부인될 경우에 대비하여 마련된 규정으로서 이와 같은 경우에만 한정적으로 적용되고 원래부터 일정한 사용자에의 종속관계를 필요로 하지 않는 산업별 직종별 지역별 노동조합 등의 경우에까지 적용되는 것은 아닌 점 등을 근거로 노조법 제2조 제1호 및 제4호 라목 본문에서 말하는 근로자에는 특정한 사용자에게 고용되어 현실적으로 취업하고 있는 자뿐만 아니라 일시적으로 실업 상태에 있는 자나 구직중인 자도 노동3권을 보장할 필요성이 있는 한 그 범위에 포함되고 따라서 지역별 노동조합의 성격을 가진 원고가 그 구성원으로 구직중인 여성 노동자를 포함시키고 있다 하더라도 구직중인 여성 노동자 역시 노조법상의 근로자에 해당하므로 구직중인 여성 노동자는 근로자가 아니라는 이유로 원고의 이 사건 노동조합설립신고를 반려한 이 사건 처분을 위법하다고 판단하였는바 이러한 원심의 판단은 정당하고 거기에 노조법에 정한 근로자의 개념에 관한 법리를 오해한 위법이 있다고 할 수 없다.그러므로 상고를 기각하고 상고비용은 패소자가 부담하도록 하여 관여 법관의 일치된 의견으로 주문과 같이 판결한다.
---
> summarization answer : 근로기준법은 현실적으로 근로를 제공하는 자에 대하여 국가의 관리·감독에 의한 직접적인 보호의 필요성이 있는가라는 관점에서 개별적 노사관계를 규율하는 목적으로 제정된 것인 반면에, 노동조합및노동관계조정법은 노무공급자들 사이의 단결권 등을 포장해 줄 필요성이 있는가의 관점에서 집단적 노사관계를 규율할 목적으로 제정된 것으로, 입법목적에 따라 근로자의 개념이 상이하게 정의하고, 일정한 사용자에의 종속관계를 조합원의 자격요건으로 하는 기업별 노동조합과는 달리, 산업별·직종별·지역별 노동조합 등의 경우에는 원래부터 사용자에의 종속관계를 조합원의 자격요건으로 하지 아닌 점에 비추어, 노동조합및노동관계조정법 제2조 제4호 라목 단서는 사용자로부터 해고됨으로써 근로자성이 부인될 경우에 대비하여 마련된 규정으로 산업별·직종별·지역별 노동조합 등의 경우에까지 적용되는 것은 아니므로, 노동조합및노동관계조정법 단서의 근로자에는 특정한 사용자에게 고용된 근로자 및 일시적으로 실업상태에 있는 자나 구직중인 자도 노동 3권을 보장할 필요성이 있는 한 그 범위에 포함된다.
---
> summarization by bert2bert : 
(7000) 근로자의 쟁의행위는 단체교섭의 대상이 되는 단체협약이나 단체협약의 성질을 가진다고 할 것이므로 단체협약이 법령에 의하여 금지되는 것이 아니라고 할 것이고, 단체협약은 단체협약에 해당하는지 여부는 단체협약으로서의 효력을 인정하기 위하여 합리적인 이유가 있는 경우에 한하여 판단하여야 한다.노동조합이 근로자의 근로조건의 향상을 위한 노사간의 자치적 교섭을 방해하였다고 하더라도 이는 단체협약에서 정한 단체협약
(25000) 근로자의 쟁의행위가 형법상 정당행위가 되기 위해서는, 첫째 그 주체가 단체교섭의 주체가 될 수 있는 자이어야 하고, 둘째 그 목적이 근로조건의 향상을 위한 노사간의 자치적 교섭을 조성하는 데에 있어야 하며, 셋째 사용자가 근로자의 근로조건 개선에 관한 구체적인 요구에 대하여 단체교섭을 거부하였을 때 개시하되 특별한 사정이 없는 한 조합원의 찬성결정 등 법령이 규정한 절차를 거쳐야 하고, 넷째 그 수단과 방법이 사용자의 재산권과
(37000)  근로자의 쟁의행위가 형법상 정당행위가 되기 위하여는 첫째 그 주체가 단체교섭의 주체로 될 수 있는 자이어야 하고, 둘째 그 목적이 근로조건의 향상을 위한 노사간의 자치적 교섭을 조성하는데 있어야 하며, 셋째 사용자가 근로자의 근로조건 개선에 관한 구체적인 요구에 대하여 단체교섭을 거부하였을 때 개시하되 특별한 사정이 없는 한 조합원의 찬성결정 등 법령이 규정한 절차를 거쳐야 하고, 넷째 그 수단과 방법이 사용자의 재산권과 조

- index 58
 > original text : 상고이유를 본다. 1.  상고이유 제1점에 대하여원심은 그 채용 증거에 의하여 피고 협회의 사무규정이 1998. 4. 1. 제정된 사실을 인정하고 이에 반하는 판시 증거들을 배척한 다음 원고가 2002. 9. 16. 피고 협회의 사무국장으로 채용될 당시 이미 판시와 같은 유죄판결의 확정으로 집행유예의 전과가 있었던 원고에게는 사무규정 제4조 제3호 소정의 금고 이상의 형을 받고 그 집행을 종료 또는 집행을 아니하기로 확정된 후 3년이 경과되지 아니한 자’에 해당하는 채용결격사유가 있었다고 판단하였다. 기록에 비추어 살펴보면 이러한 원심의 판단은 정당하고 거기에 상고이유에서 주장하는 바와 같은 채증법칙 위배 심리미진 등의 위법이 없다. 2.  상고이유 제2 3점에 대하여원심은 피고 협회가 2002. 9. 16. 원고를 기간의 정함이 없이 사무국장으로 채용하였다가이하 이 사건 근로계약’이라 한다 2005. 3. 31. 원고에게 앞서 본 바와 같은 채용결격사유가 있음을 들어 면직을 통고한 사실이하 이 사건 면직통고’라고 한다 등을 인정한 다음 상시 4인 이하의 근로자를 사용하는 피고 협회에 대하여는 구 근로기준법2007. 4. 11. 법률 제8372호로 전문 개정되기 전의 것 제30조 제1항의 정당한 사유 없는 해고 등의 제한’ 규정이 적용되지 않아 피고 협회는 기간의 정함이 없는 이 사건 근로계약을 민법 제660조 제1항에 의하여 언제든지 해지할 수 있으므로 이 사건 면직통고는 민법 제660조 제1항에 의한 고용계약의 해지통고로서 유효하고 그 정당한 사유의 유무는 위 해지통고의 효력발생요건이 아니므로 그에 대한 판단은 불필요하다고 보았다.그러나 원심의 판단은 다음과 같은 이유로 수긍할 수 없다.구 근로기준법상 상시 4인 이하의 근로자를 사용하는 사업 또는 사업장이하 4인 이하 사업장’이라 한다에 대하여는 사용자가 정당한 이유 없이 근로자를 해고하지 못한다는 구 근로기준법 제30조 제1항의 적용이 없고 이 경우 그 근로계약이 기간의 정함이 없는 것이라면 민법 제660조 제1항을 적용할 수 있게 되어 사용자는 사유를 불문하고 언제든지 근로계약의 해지를 통고할 수 있다. 그러나 민법 제660조 제1항은 당사자의 의사에 의하여 그 적용을 배제할 수 있는 임의규정이므로 4인 이하 사업장의 사용자가 근로자와 기간의 정함이 없는 근로계약을 체결하면서 해고의 사유를 열거하고 그 소정의 사유에 의하여서만 근로자를 해고할 수 있도록 하는 해고제한의 특약을 두었다면 근로자에 대한 해고는 민법 제660조 제1항이 아닌 위 해고제한의 특약에 따라야 하고 이러한 제한에 위반한 해고는 무효라고 보아야 한다.기록에 의하면 피고 협회의 사무규정은 피고 협회가 직원의 의사에 반하여 일방적으로 근로관계를 종료시킬 수 있는 경우로 해임과 징계면직의 두 가지 유형만을 정하여 두고 그 해임과 징계의 사유를 열거하면서제22조 제31조 직원은 형의 선고 징계처분 또는 이 규정에 정한 사유에 의하지 아니하고는 그 의사에 반하여 면직을 당하지 아니한다’고 하여 그 신분을 보장함으로써제59조 대구광역시체육회 처무규정 제30조 직원의 해고를 제한하고 있는 사실 피고 협회는 원고를 비롯한 직원들의 채용에 있어 그 동의를 받아 사무규정을 포함한 피고 협회의 모든 규정을 그 근로관계에 적용하여 온 사실을 알 수 있으므로 사무규정의 위와 같은 해고제한에 관한 규정은 이 사건 근로계약의 한 내용으로 편입되었다고 할 수 있다. 그렇다면 피고 협회가 4인 이하 사업장의 사용자라서 구 근로기준법 제30조 제1항에 의한 해고제한의 적용을 받지 않는다 하더라도 이 사건 근로계약의 내용을 이루는 사무규정의 해고제한에 관한 규정에는 구속되고 민법 제660조 제1항의 적용은 배제되므로 이 사건 면직통고가 사무규정에서 정한 사유에 의한 해임 또는 징계면직으로서 적법한지 여부가 문제될 뿐 이 사건 면직통고를 민법 제660조 제1항에 의한 고용계약의 해지통고라고 볼 여지는 없다.나아가 이 사건 면직통고가 사무규정에서 정한 사유에 의한 해임 또는 징계면직인지 여부에 관하여 보건대 피고 협회가 이 사건 면직통고의 사유로 삼은 원고의 위 집행유예 전과가 사무규정 제22조 제1호 소정의 해임사유인 형사상 유죄판결이 확정된 경우’에 해당하는지 여부가 쟁점이 되고 있으나 피고 협회의 사무규정에서 형사상 유죄판결이 확정된 경우를 해임사유로 규정한 취지는 유죄판결의 확정으로 인하여 근로제공의무를 이행할 수 없는 상태가 장기화되어 근로계약의 목적을 달성할 수 없게 되거나 사용자의 명예 또는 신용이 심히 실추되거나 또는 사용자와 근로자 간의 신뢰관계가 상실됨으로써 근로관계의 유지를 기대할 수 없게 되기 때문이라고 할 것이므로 대법원 1997. 5. 23. 선고 97다9239 판결 등 참조 피고 협회가 원고에게 이미 유죄판결이 확정된 집행유예의 전과가 있음을 알고서도 원고를 채용한 사실이 인정되는 이 사건에서 그와 같은 채용 전의 유죄판결확정 사실은 사무규정 제22조 제1호의 해임사유에 해당한다고 볼 수 없다. 또한 앞서 인정한 사실관계와 기록에 비추어 보면 이 사건 면직통고의 사유가 사무규정에서 정한 다른 해임사유제22조 제2호 제3호 또는 징계사유제31조 제1호 내지 제3호의 어디에도 해당되지 않음은 분명하고 달리 원고에게 사무규정 소정의 해임사유 또는 징계사유가 있음을 인정할 자료가 없다. 따라서 이 사건 면직통고는 사무규정의 위 해고제한에 위반한 것이어서 무효라고 보아야 한다.그럼에도 원심은 이 사건 면직통고가 민법 제660조 제1항에 의한 고용계약에 해당함을 전제로 그 정당한 사유 유무에 관하여 아무런 판단을 하지 않은 채 이 사건 면직통고를 유효하다고 보았는바 원심의 이러한 판단에는 해고 또는 민법 제660조 제1항의 해지통고에 관한 법리를 오해하고 그로 인하여 해고의 실체적 요건에 관한 판단을 유탈한 위법이 있고 이는 판결 결과에 영향을 미쳤다고 할 것이다. 이를 지적하는 상고논지는 이유 있다. 3.  상고이유 제4점에 대하여원심은 이 사건 면직통고는 민법 제660조 제1항에 따른 고용계약의 해지통고이지 사무규정에 의한 해임 또는 징계면직이 아니어서 피고 협회의 인사위원회규정에 따른 인사위원회의 해임 또는 징계에 관한 심의 결정 절차를 거칠 필요가 없고 설령 그러한 절차적 요건의 흠결이 있더라도 이는 그 판시와 같은 이유로 이 사건 면직통고를 무효로 볼 만한 중대한 절차적 하자에 해당하지 않는다고 판단하였다.그러나 원심의 이러한 판단 역시 수긍하기 어렵다.피고 협회의 사무규정은 그 소정의 사유에 의하여서만 직원을 해임 또는 징계면직할 수 있도록 하여 직원의 신분을 보장하고 있음은 앞서 본 바와 같고 기록에 의하면 피고 협회는 직원에 대한 공정하고도 합리적인 인사관리를 목적으로 인사위원회규정을 마련하여 직원의 해임 또는 징계에 관한 사항을 인사위원회가 심의 결정하되 그 심의대상자에게 변명의 기회를 부여할 수 있도록 규정하고 있고 이러한 인사위원회규정은 이 사건 근로계약의 한 내용으로 편입되어 그 근로관계를 규율하고 있는 사실을 알 수 있는바 이러한 인사위원회의 심의 결정 절차는 사무규정에 의한 해고의 공정성과 합리성을 확보함으로써 해고사유제한에 의한 직원의 신분보장을 실질적으로 구현하는 데 그 궁극적 목적이 있다고 볼 수 있으므로 이와 같은 위 절차의 기능과 목적 및 이에 대한 심의대상자의 기대 등을 고려하면 피고 협회가 민법 제660조 제1항에 따른 해지통고가 아닌 사무규정에 의한 해고에 해당하는 이 사건 면직통고를 함에 있어 인사위원회의 심의 결정 절차를 전혀 거치지 않은 것은 절차적 정의에 반하는 것이고 따라서 이 사건 면직통고는 절차상 중대한 하자가 있는 해고로서 무효라고 보기에 충분하다.이러한 점에서 원심의 위 판단에는 해고의 절차적 요건에 관한 법리를 오해함으로써 판결 결과에 영향을 미친 위법이 있다. 이를 지적하는 상고논지는 이유 있다. 4.  결 론그러므로 나머지 상고이유에 대한 판단을 생략한 채 원심판결을 파기하고 사건을 원심법원에 환송하기로 관여 대법관의 의견이 일치되어 주문과 같이 판결한다.

> summarization answer : 구 근로기준법상 상시 4인 이하의 근로자를 사용하는 사업 또는 사업장에 대하여는 사용자가 정당한 이유 없이 근로자를 해고하지 못한다는 같은 법 제30조 제1항이 적용되지 않고, 이 경우 그 근로계약이 기간의 정함이 없는 것이라면 민법 제660조 제1항을 적용할 수 있게 되어 사용자는 사유를 불문하고 언제든지 근로계약의 해지를 통고할 수 있다.그러나 민법 제660조 제1항은 당사자의 의사에 의하여 그 적용을 배제할 수 있는 임의규정이므로, 상시 4인 이하의 근로자를 사용하는 사업 또는 사업장의 사용자가 근로자와 기간의 정함이 없는 근로계약을 체결하면서 해고의 사유를 열거하고 그 사유에 의해서만 근로자를 해고할 수 있도록 하는 해고제한의 특약을 하였다면, 근로자에 대한 해고는 민법 제660조 제1항이 아닌 위 해고제한의 특약에 따라야 하고 이러한 제한을 위반한 해고는 무효라고 보아야 한다. 

> summarization by bert2bert : 
(7000) 배임수재죄는 타인의 사무를 처리하는 자가 그 임무에 위배하여 타인에게 손해를 가한 경우에 성립하는 것이므로 업무상배임죄가 성립하기 위하여는 타인을 위하여 업무상횡령죄로 의율할 수 있다.甲주식회사 대표이사인 피고인이 회사 자금을 임의로 사용한 경우, 甲회사의 대표이사가 甲회사를 위하여 지출한 비용은 甲회사에 귀속되는 것이므로, 甲 회사의 대표이사가 직무에 관하여
(25000) 상호신용금고법 및 시행령에 따라 폐업 후의 행위에 관하여는 양벌규정을 두지 않고 있는 점에 비추어, 피고인이 단일한 업무상배임죄의 주체가 될 수 있음은 별론으로 하고, 형법 제7조 제1항을 유추적용하여 처벌대상으로 삼은 종전의 조치가 부당하다는 데서 나온 반성적 조치라고 해석되는 경우 피고인의 행위가 업무방해죄에 해당한다고 하더라도 이를 죄형법정주의의 원칙상 업무방
(37000) 다방영업 허가를 사실상 양도받은 변호사인 피고인이 업무상횡령죄의 제3자를 폭행하여 변호사법 위반죄로 징역형을 선고받아 확정되었는데, 이후 제1심에서 징역 5년을 선고받은 경우, 원심판결 선고 후에 비로소 제1심판결이 파기되어 무죄판결이 확정된 경우, 위 징역 5년의 형을 선고함에 있어 직무유기죄는 확정된 업무방해죄와는 별개의 법인 또는 개인의 사무에 해당하므로 형법 제33조 제1항에 규정된


<br>

# Bert2Bert Summarization
Abstractive summarization using [Bert2Bert](https://arxiv.org/pdf/1907.12461.pdf) framework
![](https://user-images.githubusercontent.com/38183241/101169654-9d6fdd80-3680-11eb-96ae-965d22b05fa8.png)
<br><br>

## Dataset
- I used dataset from Dacon's summarization competition.
- You can find dataset I uesd [here](https://dacon.io/competitions/official/235673/leaderboard/).
- Put the `train.jsonl` and `abstractive_test_v2.jsonl` into `dataset` folder.
<br><br>

## Modeling
- [KoBERT](https://github.com/SKTBrain/KoBERT) (from SKT) is used for Bert2Bert framework.
- I used [KoBERT-transformers](https://github.com/monologg/KoBERT-Transformers) and [Pytorch-lightning](https://github.com/PyTorchLightning/pytorch-lightning) to reduce modeling codes. 
<br><br>

## Training
- Run `train.py` to train bert2bert model.
- I used 4 * V100 GPU to train model for 25k step.
<br><br>

## Evaluation
- Run `test.py` to evaluate bert2bert model.
- You can make submission file using `make_submission.py {CKPT_STEP}`.
- You can also find codes that calculate ROUGE score [here](https://dacon.io/competitions/official/235673/talkboard/401911?page=1&dtype=recent&ptype=pub).
<br><br>

#### Quantitive Evalutation
> |Metric|Score|
> |-------|----|
> |ROUGE-1|44.8|
> |ROUGE-2|25.8|
> |ROUGE-L|35.2|

#### Qualitive Evaluation
> Original Text : ▲ 석문간척지 임차법인협의회가 한국농어촌공사 당진지사 앞에 공공비축벼 320t을 쌓아두고 시위를 벌이고 있다. 석문간척지 임차법인협의회(이하 간척지협의회)가 농림축산식품부의 부당한 간척지 임대료 책정에 반발하며 지난달 30일 한국농어촌공사 당진지사 앞에 공공비축벼 320t을 쌓고 시위를 벌였다. 43개 영농조합법인이 소속된 간척지협의회는 이번 벼 야적 시위를 통해 현재 1kg당 2100원으로 책정된 임대료를 현재 쌀 판매가격인 1300원대로 인하할 것을 요구하고 있다. 이들은 지난 12월 7일 농림축산식품부에 탄원서를 제출했지만 “임대료 인하는 올해 이후에나 가능하다”고 통보받은 상황이다. 게다가 임차법인들의 계약기간이 올해 만료되기 때문에 임대료를 인하해도 지난 2년 동안의 손실 보상은 받을 수 없는 상황이다. 이에 간척지협의회는 계약기간을 2년 연장하고, 연장된 기간 동안 인하된 임대료를 적용해 지난 2년 간의 손실에 대해 보상할 것을 제안했다. 더불어 요구사항이 받아들여지지 않을 경우 벼 야적시위를 시작한 날짜인 지난해 12월 30일자로 임대료를 벼로 납부하겠다는 입장이다. 김재용 봉치영농조합법인 조합원은 “현재 한국농어촌공사의 답변을 기다리고 있다”며 “상황을 지켜본 뒤 추가적인 야적 시위 여부를 결정할 계획”이라고 말했다. 이어 “법을 만들고 집행할 때 현실성 있게 만들어야 한다”며 “농민이 정부를 믿을 수 있도록 조속히 해결책을 마련해주길 바란다”고 덧붙였다.
---
> Summarized : 석문간척지 임차법인협의회가 지난달 30일 한국농어촌공사 당진지사 앞에서 농림축산식품부의 부당한 간척지 임대료 책정에 반발하며 벼 야적장 320t을 쌓아놓고 인근 영농인들에게 공공비축쌀 임대료를 받을 수 있도록 인하해 달라고 요구했다.

<br>

## Licence
    Copyright 2020 Hyunwoong Ko.
    
    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at
    
    http://www.apache.org/licenses/LICENSE-2.0
    
    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
